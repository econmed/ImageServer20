<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2" assembly="ClearCanvas.Healthcare" namespace="ClearCanvas.Healthcare">

  <!-- 
    Obtains the procedure history for a specified patient.
    Parameters: 1. the patient.
  -->
  <query name="procedureHistory">
    select rp
    from Procedure rp
    join rp.Order o
    join fetch rp.Order
    join fetch o.Visit
    where o.Patient = ?
  </query>
  
  <!-- 
    Obtains the order history for a specified patient.
    Parameters: 1. the patient.
  -->
  <query name="orderHistory">
    select o
    from Order o
    join fetch o.Visit
    where o.Patient = ?
  </query>

  <!-- 
    Obtains the report history for a specified patient.
    Parameters: 1. the patient.
  -->
  <query name="reportHistory">
    select r
    from Report r
    join r.Procedures rp
    join rp.Order o
    join fetch r.Procedures
    join fetch rp.Order
    join fetch o.Visit
    where o.Patient = ?
    and r.Status not in ('X')
  </query>
  
  <!-- 
    Obtains the reports for a specified order.
    Parameters: 1. the order.
  -->
  <query name="reportsForOrder">
    select r
    from Report r
    join r.Procedures rp
    join rp.Order o
    join fetch r.Procedures
    join fetch rp.Order
    join fetch o.Visit
    where o = ?
    and r.Status not in ('X')
  </query>
</hibernate-mapping>
