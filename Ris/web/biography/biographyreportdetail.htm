<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Report Preview</title>
<link href="../css/default.css" rel="stylesheet" type="text/css" />
<link href="../css/tabs.css" rel="stylesheet" type="text/css" />
<link href="../css/structuredreport.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../js/jsx.js"></script>
<script type="text/javascript" src="../js/jsml.js"></script>
<script type="text/javascript" src="../js/ui.js"></script>
<script type="text/javascript" src="../js/ris.js"></script>
<script type="text/javascript" src="../js/preview.js"></script>
<script type="text/javascript" src="../js/layout.js"></script>
<script type="text/javascript" src="../js/tabs.js"></script>
<script type="text/javascript" src="../js/structuredreportsummary.js"></script>
<script type="text/javascript" >
		var errorProvider = new ErrorProvider();

		function onBodyLoad()
		{

			scaleWidth();

			if(!Ris)
				return;

			try

			{
				var reportRef = Ris.getHealthcareContext();
				if (reportRef == null)
				{
					Field.setValue($("myForm"), "");
					return;
				}

				// construct request object
				var request = 
				{
					// only request the report detail if there is a report     
					GetReportDetailRequest:{ ReportRef: reportRef }
				};

				var service = Ris.getPatientDataService();

				var data = service.getData(request);

				if (data == null || data.length == 0)
				{
					Field.setValue($("myForm"), "");
					return;

				}

				var reportDetail = data.GetReportDetailResponse ? data.GetReportDetailResponse.Report : null;
				
				if (reportDetail)
				{
					var procedures = reportDetail.Procedures;
					createProceduresTable($("proceduresTable"), procedures);
					createReportPreview($("report"), reportDetail);
				}
				else
				{
					// hide report section
					Field.show($("proceduresTable"), false);
					Field.show($("reportSection"), false);
				}
			}
			catch(e)
			{
				var message = "Failed to load preview page.  An exception occurred in the script. Error name: " + e.name + ". Error message: " + e.message;
				Field.setValue($("myForm"), message);
			}
		}
</script>
</head>
<body onload="javascript: onBodyLoad()">
	<form id="myForm">
		<div id="reportSection">
			<p id="reportheading" class="sectionheading">Report</p>
			<table border="0" id="proceduresTable">
				<tr class="tableheading">
					<td>Procedure</td>
					<td>Protocol</td>
					<td>Code</td>
				</tr>
				<!-- this empty row is here so the color of the first data row is consistent with other previews -->
				<tr colspan="3"></tr>
			</table>
			<div id="report"></div>
		</div>
	</form>
</body>
</html>