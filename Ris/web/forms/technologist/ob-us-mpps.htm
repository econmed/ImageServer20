<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>OB/US</title>
	<link href="../../css/default.css" rel="stylesheet" type="text/css" />
	<link href="../../css/tabs.css" rel="stylesheet" type="text/css" />
	<link href="../../js/calendar/calendar-system.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="../../js/calendar/calendar.js"></script>
	<script type="text/javascript" src="../../js/calendar/lang/calendar-en.js"></script>
	<script type="text/javascript" src="../../js/jsx.js"></script>
	<script type="text/javascript" src="../../js/jsml.js"></script>
	<script type="text/javascript" src="../../js/ui.js"></script>
	<script type="text/javascript" src="../../js/ris.js"></script>
	<script type="text/javascript" src="../../js/layout.js"></script>
	<script type="text/javascript" src="../../js/collapse.js"></script>
	<script type="text/javascript" src="../../js/tabs.js"></script>
	<script type="text/javascript" src="../../js/structuredreport.js"></script>

	<script type="text/javascript">
		var data = {};
		var errorProvider = new ErrorProvider();

		function onBodyLoad()
		{
			try
			{
				scaleWidth();

				var startTime;
				var stopTime;

				if(Ris)
				{
					data = JSML.parse(Ris.getTag("Documentation")) ||{};

				  var mpps = Ris.getHealthcareContext();
                  startTime = mpps.StartTime;
                  stopTime = mpps.EndTime;
				}

				// redirect if this data was captured by a page other than this page
				// (data should be presented by the same version of the page that captured it)
				if(data.capturePageUrl && data.capturePageUrl != window.location)
				{
					window.location = data.capturePageUrl;
				}

				data.acquisition = data.acquisition || {};
				data.acquisition.startTime = data.acquisition.startTime || startTime;
				data.acquisition.stopTime = data.acquisition.stopTime || stopTime;
				
				initAcquisitionTable();  

				$("structuredReport").innerHTML = structuredReportHtml();
				initStructuredReport(data, false);
			}
			catch(e)
			{
				var message = "Failed to load details page.  An exception occurred in the script. Error name: " + e.name + ". Error message: " + e.message;
				Field.setValue($("myForm"), message);
			}
		}

		function initAcquisitionTable()
		{
			var table = Table.createTable(
				$("acquisitionTable"), 
				{ editInPlace: true, flow: true, checkBoxes: false },
				[
					{
						label: "Start Date/Time",
						cellType: "readonly",
						getValue: function(item) { return Ris.formatDateTime(item.startTime); }
					},
					{
						label: "Stop Date/Time",
						cellType: "readonly",
						getValue: function(item) { return Ris.formatDateTime(item.stopTime); }
					},
					{
						label: "Equipment/Device ID/Location",
						cellType: "text",
						size: 30,
						getValue: function(item) { return item.equipment; },
						setValue: function(item, value) { item.equipment = value; },
						getError: function(item) { return null; }
					}
				]);

			table.errorProvider = errorProvider;   // share errorProvider with the rest of the form
			table.bindItems([data.acquisition]);
		}

		//////////////////////////////////////////////////////////////////////////
		// RIS integration API
		function showValidation(show)
		{
			errorProvider.setVisible(show);
		}

		function hasValidationErrors()
		{
			return errorProvider.hasErrors();
		}

		function saveData()
		{
			data.capturePageUrl = window.location;
			Ris.setTag("Documentation", JSML.create(data, "data"));
		}
		//////////////////////////////////////////////////////////////////////////

</script>
<style type="text/css">
	#generalTable td,tr { width:100%; } 
	#generalTable .divCell { width:48%; }
</style>
</head>
<body onload="javascript: onBodyLoad()" onresize="javascript: scaleWidth()">
	<form id="myForm">
		<p class="sectionheading">Exam Acquisition/Mpps</p>
		<table id="acquisitionTable" width="100%">
			<tr><td class="tableheading"></td></tr>
		</table>
		<div id="structuredReport"></div>
	</form>
</body>
</html>
