<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Received Fax Preview Page</title>
		<link href="../css/default.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="../js/jsx.js"></script>
		<script type="text/javascript" src="../js/jsml.js"></script>
		<script type="text/javascript" src="../js/ui.js"></script>
		<script type="text/javascript" src="../js/ris.js"></script>
		<script type="text/javascript" src="../js/layout.js"></script>
		<script type="text/javascript" src="../js/pdfSupport.js"></script>
		<script type="text/javascript" >
		var imagePath = "../images";
		
		function onBodyLoad()
		{
				try
				{
					if(!Ris)
						return;

					var faxboxItem = Ris.getHealthcareContext();

					var faxUrl = faxboxItem ? Ris.getAttachedDocumentUrl(faxboxItem.Document) : "about:blank";
					
					var urlExtension = faxUrl.substring(faxUrl.length - 3, faxUrl.length).toLowerCase();;
					if (urlExtension == "pdf")
					{
						// show PDF in the embedded object.  Use exposed methods to hide toolbar
						var pdfObject = PdfObject("PdfObject", faxUrl);
						pdfObject.createToolbar("PdfButtons");
					}
					else
					{
						// redirect all other documents
						window.location = faxUrl;
					}
					
					var previewInfo = 
						'<table border="0" cellspacing="0" cellpadding="0" class="PatientDemographicsTable">'+
						'	<tr>'+
						'		<td valign="top" class="DemographicsLabel" nowrap="nowrap">From #: </td><td valign="top" class="DemographicsCell" nowrap="nowrap"><div id="fromNumber"/></td>'+
						'		<td valign="top" class="DemographicsLabel" nowrap="nowrap">To #: </td><td valign="top" class="DemographicsCell" nowrap="nowrap"><div id="toNumber"/></td>'+
						'   </tr>'+
						'	<tr>'+
						'		<td valign="top" class="DemographicsLabel" nowrap="nowrap">Original Copy: </td><td valign="top" class="DemographicsCell" nowrap="nowrap"><div id="original"/></td>'+
						'	</tr>'+
						'</table>';

					$("faxPreviewInfo").innerHTML = previewInfo;
					
					if(faxboxItem != null)
					{
						Field.setValue($("fromNumber"), faxboxItem.SenderNumber);
						Field.setValue($("toNumber"), faxboxItem.ReceivedAt.Number);
						Field.setValue($("original"), "lol"); // TODO: Implement.
					}
					else
					{
						Field.setValue($("fromNumber"), "Not found.");
						Field.setValue($("toNumber"), "Not found.");
						Field.setValue($("original"), "lol");
					}
				}
				catch(e)
				{
					var message = "Failed to load details page.  An exception occurred in the script. Error name: " + e.name + ". Error message: " + e.message;
					Field.setValue($("errorMsg"), message);
				}
		}


		</script>
	</head>
	<body onload="onBodyLoad()">
		<div id="faxPreviewInfo"></div>
		<div id="PdfButtons"></div>
		<object id="PdfObject" type="application/pdf"></object>
		<div id="errorMsg" />
	</body>
</html>
